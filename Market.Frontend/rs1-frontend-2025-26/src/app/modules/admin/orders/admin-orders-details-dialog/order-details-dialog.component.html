<div class="dialog-container">
  <!-- Header -->
  <div class="dialog-header">
    <div class="header-left">
      <mat-icon class="header-icon">receipt_long</mat-icon>
      <h2 mat-dialog-title>
        {{ 'ORDERS.DETAILS.TITLE' | translate }}
        <span class="order-ref" *ngIf="order">{{ order.referenceNumber }}</span>
      </h2>
    </div>
    <button mat-icon-button (click)="onClose()" class="close-btn">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="48" color="primary"></mat-spinner>
    <p>{{ 'ORDERS.DETAILS.LOADING' | translate }}</p>
  </div>

  <!-- Error -->
  <div *ngIf="!isLoading && errorMessage" class="error-container">
    <mat-icon>error_outline</mat-icon>
    <div class="error-content">
      <p>{{ errorMessage }}</p>
      <button mat-stroked-button color="primary" (click)="retry()">
        <mat-icon>refresh</mat-icon>
        {{ 'ORDERS.RETRY' | translate }}
      </button>
    </div>
  </div>

  <!-- Content -->
  <div mat-dialog-content *ngIf="!isLoading && !errorMessage && order" class="dialog-content">

    <!-- Status Section -->
    <div class="status-section">
      <div class="status-badge-large" [ngClass]="getStatusClass(order.status)">
        <mat-icon>{{ getStatusIcon(order.status) }}</mat-icon>
        <span>{{ getStatusLabel(order.status) | translate }}</span>
      </div>

      <div class="dates-info">
        <div class="date-item">
          <mat-icon>schedule</mat-icon>
          <div>
            <span class="label">{{ 'ORDERS.DETAILS.ORDERED_AT' | translate }}</span>
            <span class="value">{{ order.orderedAtUtc | date:'dd.MM.yyyy HH:mm' }}</span>
          </div>
        </div>
        <div class="date-item" *ngIf="order.paidAtUtc">
          <mat-icon>payment</mat-icon>
          <div>
            <span class="label">{{ 'ORDERS.DETAILS.PAID_AT' | translate }}</span>
            <span class="value">{{ order.paidAtUtc | date:'dd.MM.yyyy HH:mm' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Customer Info Section -->
    <mat-card class="info-card">
      <mat-card-header>
        <mat-icon mat-card-avatar>person</mat-icon>
        <mat-card-title>{{ 'ORDERS.DETAILS.CUSTOMER_INFO' | translate }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">{{ 'ORDERS.DETAILS.CUSTOMER_NAME' | translate }}</span>
            <span class="info-value">{{ getCustomerName() }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">{{ 'ORDERS.DETAILS.ADDRESS' | translate }}</span>
            <span class="info-value">{{ getCustomerAddress() }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Order Items Section -->
    <mat-card class="info-card items-card">
      <mat-card-header>
        <mat-icon mat-card-avatar>shopping_basket</mat-icon>
        <mat-card-title>{{ 'ORDERS.DETAILS.ORDER_ITEMS' | translate }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <table class="items-table">
          <thead>
          <tr>
            <th>{{ 'ORDERS.DETAILS.PRODUCT' | translate }}</th>
            <th class="text-right">{{ 'ORDERS.DETAILS.QUANTITY' | translate }}</th>
            <th class="text-right">{{ 'ORDERS.DETAILS.UNIT_PRICE' | translate }}</th>
            <th class="text-right">{{ 'ORDERS.DETAILS.DISCOUNT' | translate }}</th>
            <th class="text-right">{{ 'ORDERS.DETAILS.TOTAL' | translate }}</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let item of order.items">
            <td class="product-cell">
              <span class="product-name">{{ item.product.productName }}</span>
            </td>
            <td class="text-right">{{ item.quantity }}</td>
            <td class="text-right">{{ item.unitPrice | currency:'BAM':'symbol':'1.2-2' }}</td>
            <td class="text-right discount-cell">
              <span *ngIf="item.discountAmount && item.discountAmount > 0">
                -{{ item.discountAmount | currency:'BAM':'symbol':'1.2-2' }}
                <span class="discount-percent" *ngIf="item.discountPercent">({{ item.discountPercent }}%)</span>
              </span>
              <span *ngIf="!item.discountAmount || item.discountAmount === 0">-</span>
            </td>
            <td class="text-right total-cell">{{ item.total | currency:'BAM':'symbol':'1.2-2' }}</td>
          </tr>
          </tbody>
          <tfoot>
          <tr class="total-row">
            <td colspan="4" class="text-right"><strong>{{ 'ORDERS.DETAILS.ORDER_TOTAL' | translate }}</strong></td>
            <td class="text-right total-amount"><strong>{{ order.totalAmount | currency:'BAM':'symbol':'1.2-2' }}</strong></td>
          </tr>
          </tfoot>
        </table>
      </mat-card-content>
    </mat-card>

    <!-- Note Section (if exists) -->
    <mat-card class="info-card" *ngIf="order.note">
      <mat-card-header>
        <mat-icon mat-card-avatar>notes</mat-icon>
        <mat-card-title>{{ 'ORDERS.DETAILS.NOTE' | translate }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p class="note-text">{{ order.note }}</p>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Actions -->
  <div mat-dialog-actions class="dialog-actions" *ngIf="!isLoading && !errorMessage">
    <button mat-button (click)="onClose()">
      {{ 'COMMON.CLOSE' | translate }}
    </button>
  </div>
</div>
