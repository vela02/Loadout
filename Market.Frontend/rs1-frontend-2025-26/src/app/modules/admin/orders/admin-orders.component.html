<div class="container">
  <!-- Header Card -->
  <div class="header-card">
    <div class="header-card-content">
      <!-- Left: Title with Icon -->
      <div class="title-section">
        <div class="title-icon">
          <mat-icon>shopping_cart</mat-icon>
        </div>
        <h1>{{ 'ORDERS.TITLE' | translate }}</h1>
      </div>

      <!-- Right: Filters and Actions -->
      <div class="actions-container">
        <!-- Status Filter -->
        <mat-form-field class="filter-field" appearance="fill">
          <mat-label>{{ 'ORDERS.FILTER_STATUS' | translate }}</mat-label>
          <mat-select [(ngModel)]="statusFilter" (selectionChange)="onStatusFilterChange($event.value)">
            <mat-option [value]="null">{{ 'ORDERS.ALL_STATUSES' | translate }}</mat-option>
            <mat-option *ngFor="let option of statusOptions" [value]="option.value">
              <div class="status-option">
                <mat-icon>{{ option.icon }}</mat-icon>
                <span>{{ option.label | translate }}</span>
              </div>
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>filter_list</mat-icon>
        </mat-form-field>

        <!-- Search -->
        <mat-form-field class="search-field" appearance="fill">
          <mat-label>{{ 'ORDERS.SEARCH_PLACEHOLDER' | translate }}</mat-label>
          <input
            matInput
            [formControl]="searchControl"
            [placeholder]="'ORDERS.SEARCH_INPUT_PLACEHOLDER' | translate"
          />
          <mat-icon matSuffix>search</mat-icon>
          <mat-hint *ngIf="searchControl.value && searchControl.value.length < 3">
            {{ 'ORDERS.SEARCH_MIN_LENGTH' | translate }}
          </mat-hint>
        </mat-form-field>

        <!-- Clear Filters Button -->
        <button
          mat-stroked-button
          (click)="clearFilters()"
          [disabled]="!searchControl.value && !statusFilter"
          class="clear-filters-btn">
          <mat-icon>clear_all</mat-icon>
          <span>{{ 'ORDERS.CLEAR_FILTERS' | translate }}</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Skeleton Loader -->
  <app-fit-table-skeleton
    *ngIf="isLoading && !errorMessage"
    [rows]="10"
    [columns]="5"
    [showActions]="true">
  </app-fit-table-skeleton>

  <!-- Error -->
  <div *ngIf="!isLoading && errorMessage" class="error-container">
    <mat-icon>error_outline</mat-icon>
    <div class="error-content">
      <p class="error-title">{{ 'ORDERS.ERROR_TITLE' | translate }}</p>
      <p class="error-message">{{ errorMessage }}</p>
      <button mat-stroked-button color="primary" (click)="loadPagedData()">
        <mat-icon>refresh</mat-icon>
        {{ 'ORDERS.RETRY' | translate }}
      </button>
    </div>
  </div>

  <!-- Table Card -->
  <div class="table-card" *ngIf="!isLoading && !errorMessage">
    <table mat-table [dataSource]="items" class="orders-table">

      <!-- Reference Number Column -->
      <ng-container matColumnDef="referenceNumber">
        <th mat-header-cell *matHeaderCellDef>
          <div class="header-cell">
            <mat-icon class="header-icon">confirmation_number</mat-icon>
            {{ 'ORDERS.TABLE.ORDER_NUMBER' | translate }}
          </div>
        </th>
        <td mat-cell *matCellDef="let order">
          <span class="order-ref">{{ order.referenceNumber }}</span>
        </td>
      </ng-container>

      <!-- Customer Column -->
      <ng-container matColumnDef="customer">
        <th mat-header-cell *matHeaderCellDef>
          <div class="header-cell">
            <mat-icon class="header-icon">person</mat-icon>
            {{ 'ORDERS.TABLE.CUSTOMER' | translate }}
          </div>
        </th>
        <td mat-cell *matCellDef="let order">
          <div class="customer-info">
            <span class="customer-name">{{ getCustomerName(order) }}</span>
            <span class="customer-address">{{ getCustomerAddress(order) }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Ordered At Column -->
      <ng-container matColumnDef="orderedAt">
        <th mat-header-cell *matHeaderCellDef>
          <div class="header-cell">
            <mat-icon class="header-icon">schedule</mat-icon>
            {{ 'ORDERS.TABLE.ORDER_DATE' | translate }}
          </div>
        </th>
        <td mat-cell *matCellDef="let order">
          <div class="date-info">
            <span class="date">{{ order.orderedAtUtc | date:'dd.MM.yyyy' }}</span>
            <span class="time">{{ order.orderedAtUtc | date:'HH:mm' }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Total Amount Column -->
      <ng-container matColumnDef="totalAmount">
        <th mat-header-cell *matHeaderCellDef>
          <div class="header-cell">
            <mat-icon class="header-icon">payments</mat-icon>
            {{ 'ORDERS.TABLE.TOTAL_AMOUNT' | translate }}
          </div>
        </th>
        <td mat-cell *matCellDef="let order">
          <span class="amount">{{ order.totalAmount | currency:'BAM' }}</span>
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>
          <div class="header-cell">
            <mat-icon class="header-icon">flag</mat-icon>
            {{ 'ORDERS.TABLE.STATUS' | translate }}
          </div>
        </th>
        <td mat-cell *matCellDef="let order">
          <div class="status-badge" [ngClass]="getStatusClass(order.status)">
            <mat-icon>{{ getStatusIcon(order.status) }}</mat-icon>
            <span>{{ getStatusLabel(order.status) | translate }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>
          <div class="header-cell">
            <mat-icon class="header-icon">settings</mat-icon>
            {{ 'ORDERS.TABLE.ACTIONS' | translate }}
          </div>
        </th>
        <td mat-cell *matCellDef="let order">
          <div class="action-buttons">
            <button
              mat-icon-button
              color="primary"
              (click)="onViewDetails(order, $event)"
              [matTooltip]="'ORDERS.ACTIONS.VIEW_DETAILS' | translate"
              class="action-btn view-btn">
              <mat-icon>visibility</mat-icon>
            </button>
            <button
              mat-icon-button
              color="accent"
              (click)="onChangeStatus(order, $event)"
              [matTooltip]="'ORDERS.ACTIONS.CHANGE_STATUS' | translate"
              [disabled]="!canChangeStatus(order)"
              class="action-btn status-btn">
              <mat-icon>swap_horiz</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <!-- Header Row -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

      <!-- Data Rows -->
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        class="data-row"
        (click)="onViewDetails(row)">
      </tr>

      <!-- No Data Row -->
      <tr class="mat-row no-data-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">
          <div class="no-data-content">
            <mat-icon>shopping_cart</mat-icon>
            <p>
              <ng-container *ngIf="searchControl.value || statusFilter; else noDataDefault">
                {{ 'ORDERS.NO_DATA_FILTER' | translate }}
              </ng-container>
              <ng-template #noDataDefault>
                {{ 'ORDERS.NO_DATA' | translate }}
              </ng-template>
            </p>
          </div>
        </td>
      </tr>
    </table>

    <!-- Paginator -->
    <div class="paginator-wrapper">
      <app-fit-paginator-bar [vm]="this"></app-fit-paginator-bar>
    </div>
  </div>
</div>
